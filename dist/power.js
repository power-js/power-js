!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.power={})}(this,function(t){"use strict";var d="power-id",u=function(t,e){return JSON.stringify(t)===JSON.stringify(e)},h=function(t){return(t.startsWith("on")?t.toLowerCase():"on".concat(t))in window},f=function(t){return t&&t.constructor===s},r={},e={};["Array","Boolean","Date","Error","Function","Null","Number","Object","RegExp","String","Undefined"].forEach(function(t){var n=t.toLowerCase();r["[object ".concat(t,"]")]=n,e["is".concat(t)]=function(t){return(null===(e=t)?String(e):r[{}.toString.call(e)])===n;var e}});var p=e.isArray,i=e.isFunction,a=e.isObject,v=e.isString,o=0;function s(t,e,n){if(this.tagName=t||"div",this.children=n||[],this.props=e||{},i(this.tagName)){var r=new this.tagName(this.props);return r.render?r.render():r}return o+=1,this.props[d]=o,this}var l=[];function n(t,e){for(var n=[],r=arguments.length;2<r--;)l[l.length]=arguments[r];for(;l.length;){var o=l.pop();if(o&&o.pop)for(var i=o.length;i--;)l[l.length]=o[i];else"boolean"==typeof o&&(o=null),"number"==typeof o&&(o=String(o)),"function"!=typeof o&&null==o&&(o=""),n[n.length]=o}return new s(t,e,n)}var c=function(t){return this.$events[t.type](t)},m=function(t,e,n){if(!u(e,n)&&(v(e)&&(t.style.cssText=e),a(e))){if(a(n))for(var r in n)r in e||(t.style[r]="");for(var o in e)t.style[o]=e[o]}},g={htmlFor:"for",className:"class"},y=function(t,e,n){if(n)for(var r in n)e[r]||(h(r)&&t.$events[r]?t.removeEventListener(r,t.$events[r]):t.removeAttribute(g[r]||r));for(var o in e)"style"!==o||u(t.style,e.style)?h(o)?(a=t,p=e[s=o],void 0,l=s.startsWith("on")?s.substring(2,s.length).toLowerCase():s,a.addEventListener(l,c),a.$events||(a.$events={}),a.$events[l]=p):((i=o)in t||"class"===i||i.startsWith("data-")||i.startsWith("power-")||"key"===o)&&(t[o]&&e[o]===t[o]||t.setAttribute(g[o]||o,e[o])):m(t,e[o]);var i,a,s,p,l},w=function(t){var e=document.createElement(t.tagName),n=document.createDocumentFragment();return t.children&&t.children.length&&function t(e,n){for(var r=0,o=n.length;r<o;r++){var i=n[r];f(i)?(s=i,e.appendChild(w(s))):p(i)?t(e,i):(a=i,e.appendChild(document.createTextNode(a)))}var a,s}(n,t.children),e.appendChild(n),t.props&&Object.keys(t.props).length&&y(e,t.props),e},b=function t(e,n){var r=n||document.body;if(i(e.tagName))return t(new e.tagName(e.props),r);if(!f(e)&&!e._power)return t(new e,r);e._power&&e.componentWillMount&&e.componentWillMount(e);var o=e._power?e.create():w(e);return o instanceof Element&&r.appendChild(o),e._power&&e.componentDidMount&&e.componentDidMount(e),e};function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var k=function(t){for(var e=[].slice.call(arguments,1),n=0,r=e.length;n<r;n++){var o=e[n];for(var i in o)t[i]=o[i]}return t},N=function(t,e,n){var r=t.props[d];null===e.props&&(e.props={}),e.props[d]=r;var o,i,a,s,p,l=n.node.querySelector("[".concat(d,'="').concat(r,'"]')),h=e.children,c=t.children;o=c,(i=h).length&&i[0].props&&void 0!==i[0].props.key||o.length&&o[0].props&&void 0!==o[0].props.key?function(t,e,n){var r=t.map(function(t){return t.props.key}),o=e.map(function(t){return t.props.key});if(r.length===o.length)for(var i=n.children.length,a=0;a<i;a++)n.replaceChild(w(e[a]),n.children[a]);else{var s=function(t,e){for(var n=[],r=[],o=t.length,i=e.length,a=0;a<o;a++)n[t[a]]=!0;for(var s=0;s<i;s++)n[e[s]]?delete n[e[s]]:n[e[s]]=!0;for(var p in n)r[r.length]=p;return r}(r,o),p=s.length;if(r.length>o.length)for(var l=0;l<p;l++)for(var h=s[l],c=0,u=n.children.length;c<u;c++){var d=n.children[c];if(d&&d.attributes.key.value===h){n.removeChild(d);break}}else if(r.length<o.length)for(var f=0;f<p;f++)for(var v=s[f],m=e.length-1;0<=m;m--){var g=e[m];if(String(g.props.key)===v){n.appendChild(w(g));break}}}}(c,h,l):function t(e,n,r,o){for(var i=0,a=n.length;i<a;i++){var s=n[i];if(void 0===e[i]&&f(s)){s.props||(s.props={});var p=w(s,o);r.appendChild(p)}else if(v(s)&&s!==e[i]){var l=document.createTextNode(s);r.replaceChild(l,r.childNodes[i])}else f(s)?N(e[i],s,o):s.pop&&e[i]&&e[i].pop&&t(e[i],s,r,o)}for(var h,c=e.length-n.length,u=e.length-1;0<c;)(h=o.node.querySelector("[".concat(d,'="').concat(e[u].props[d],'"]')))&&h.parentNode&&h.parentNode.removeChild(h),u-=1,c-=1}(c,h,l,n),a=t.props,s=e.props,p=l,u(a,s)||y(p,s,a)},D=["push","pop","shift","unshift","splice"],S=function(){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=this.constructor;this.componentWillInitialize&&this.componentWillInitialize(this),this._power=!0,this.name=e.name,this.props=i(this.getDefaultProps)?this.getDefaultProps():a(e.defaultProps)?e.defaultProps:{},t&&(this.props=k({},this.props,t)),this.state=i(this.getInitialState)?this.getInitialState():a(e.initialState)?e.initialState:{},this.componentDidInitialize&&this.componentDidInitialize(this)}var t,e,r;return t=n,(e=[{key:"create",value:function(){var o,t;return this.node=document.createElement(this.name),this.node.setAttribute("power-component",!0),this.props=(t=(o=this).props,new Proxy(t,{get:function(t,e){var n=t[e],r={get:function(e,n){var t=e[n];return i(t)&&p(e)?function(){var t=Array.prototype[n].apply(e,arguments);return D.includes(n)&&o.shouldComponentUpdate(o.props,o.state)&&o.update(),t}:t}};return p(n)?new Proxy(n,r):n},set:function(t,e,n){var r=t[e];return o.shouldComponentUpdate(t,o.state)&&r!==n&&(t[e]=n,o.update()),!0}})),this.componentVDom=this.render(),this.node.appendChild(w(this.componentVDom,this)),this.node}},{key:"shouldComponentUpdate",value:function(){return!0}},{key:"setState",value:function(t,e){var n=this.state;if(!u(t,n)){var r=this.props,o=t;if(i(o)&&(o=o.call(this,n,r)),o=k({},n,o),!this.shouldComponentUpdate(r,o))return!1;this.state=o,this.update(),i(e)&&e.call(this)}}},{key:"forceUpdate",value:function(t){this.update(),i(t)&&t.call(this)}},{key:"update",value:function(){this.componentWillUpdate&&this.componentWillUpdate(this);var t=this.render();this.patch(this.componentVDom,t),this.componentVDom=t,this.componentDidUpdate&&this.componentDidUpdate(this)}},{key:"patch",value:function(t,e){N(t,e,this)}},{key:"destroy",value:function(){this.componentWillUnmount&&this.componentWillUnmount(this),this.node.parentNode.removeChild(this.node),this.node=null,this.componentDidUnmount&&this.componentDidUnmount(this)}}])&&C(t.prototype,e),r&&C(t,r),n}(),U="1.0.0-alpha",W={h:n,render:b,Component:S,version:U};t.default=W,t.h=n,t.render=b,t.Component=S,t.version=U,Object.defineProperty(t,"__esModule",{value:!0})});
